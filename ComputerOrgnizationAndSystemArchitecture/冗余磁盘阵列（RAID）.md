# 冗余磁盘阵列（RAID）

* 冗余磁盘阵列/独立磁盘冗余阵列：Redundant Arrays of Independent Disks(RAID)
* 基本思想
	* 将多个独立操作的磁盘按某种方式组织成磁盘阵列，以增加容量
	* 将数据存储在多个盘体上，通过这些盘并行工作来提高数据传输率
	* 采用**数据冗余**来进行错误恢复以提高系统可靠性
* 特性
	* 由一组物理磁盘驱动器组成，被视为单个的**逻辑**驱动器
	* 数据是分布在多个物理磁盘上
	* 冗余磁盘容量用于**存储校验信息**，保证磁盘万一损坏时能恢复数据





## RAID0

* 数据以条带的形式在可用的磁盘上分布
* 不采用冗余来改善性能（并非真正的RAID
* 用途
	* 高数据传输率
	* 高速响应I/O请求

**与单个大容量磁盘相比**：

* 高数据传输率：读取的时候可以多个物理磁盘并行读取，写的时候也可以对多个物理的磁盘进行同时读写。但对于单个磁盘，我们必须要进行顺序的存取。
* 高速响应I/O请求：两个I/O请求所需要的数据块可能在不同的硬盘上。因此相比单个磁盘会有更高速的响应。
* **代价**：磁盘损坏概率升高



## RAID1

* 采用了数据条带
* 采用简单地备份所有数据的方法来实现冗余（即将磁盘分成了两半，一半为冗余盘，对原本数据进行拷贝）
* 好处：
	* 硬盘损坏（只有一个）对整体没有影响，（若损坏多个硬盘呢？
	* 如果有两个位于同一个磁盘的I/O请求，RAID1也可以同时响应。
	* 数据传输率也会提高，因为可以对同一个磁盘上不同条带的数据进行同时存取（冗余盘和正常使用盘同时读取）
* 坏处：对磁盘进行写操作的时候，需要写两个磁盘（冗余盘和正常使用盘），效率较低。但其实可以并行完成，取决于拷贝盘和数据盘中较慢的一个写来决定（即包含较大的寻道时间和旋转延迟的那一个写）。

**优点**：

* 高速响应I/O请求：即便是同一个磁盘上的数据块，也可以由两组硬盘分别响应
* 读请求可以由包含请求数据的两个对应磁盘中的某一个提供服务，可以选择寻道时间较小的那个
* 写请求需要更新两个对应的条带：可以并行完成，但受限于写入较慢的磁盘
* 单个磁盘损坏时不会影响数据访问，恢复受损磁盘简单

**缺点**

* 价格昂贵

**用途**

* 只限于用在存储系统软件/数据和其他关键文件的驱动器中

**与RAID0相比**

* 如果有大批的**读请求**，则RAID1能实现高速的I/O速率，性能可以达到RAID0的两倍
* 如果I/O请求有相当大的部分是**写请求**，则它不比RAID0的性能好多少。



## RAID01 vs RAID10

* RAID 01 = RAID 0 + 1:先做RAID 0，再做RAID 1
* RAID 10 = RAID 1 + 0:先做RAID 1，再做RAID 0
* 两者在数据传输率和磁盘利用率上没有明显区别，主要区别是对磁盘损坏的容错能力。（RAID 01较弱，因为不能跨越RAID 0进行合作。）
* RAID 01 是先分好组的（即先组成RAID0，再组成RAID1），如果组里面有一个不能用了，那么该组的所有磁盘都会失效。这样就会导致容错率大大下降。



## RAID2

* 采用并行存取技术
* 目标
	* 所有磁盘都参与每个I/O请求的执行
* 特点
	* 各个驱动器的轴是同步旋转的，因此每个磁盘上的每个磁头在任何时刻都位于同一位置
	* 采用数据条带：条带非常小，经常只有一个字节或一个字
* 纠错
	* 对位于同一条带的各个数据盘上的数据位计算校验码（通常采用海明码），校验码存储在该条带中多个校验盘的对应位置
* 访问
	* 读取：获取请求的数据和对应的校验码
	* 写入：所有数据盘和校验盘都被访问
* 缺点
	* 冗余盘依然比较多，价格较贵
	* 适用于多磁盘易出错环境，对于单个磁盘和磁盘驱动器已经具备高可靠性的情况没有意义。



## RAID3

* 采用并行存取技术

	* 各个驱动器的轴同步旋转
	* 采用非常小的数据条带

* 对所有数据盘上同一位置的数据计算<span style='color: red'>**奇偶校验码**</span>

	* 当某一次盘损坏（已经**明确**知道哪一位是有问题的）时，可以用于重构数据
		$$
		b_0 = P(b) \oplus b_1 \oplus b_2 \oplus b_3
		$$

* 优缺点

	* 优点：能够获得非常高的数据传输率
		* 对于大量传送，性能改善特别明显
	* 缺点：一次只能执行一个I/O请求
		* 在面向多个IO请求时，性能将受损



## RAID4

* 采用独立存取技术

	* 每个磁盘成员的操作是独立的，各个I/O请求能够并行处理

* 采用相对较大的数据条带

* 根据各个数据盘上的数据来逐位计算奇偶校验条带，奇偶校验位存储在奇偶校验盘的对应条带上。

* 性能

	* 当执行较小规模的I/O请求时，RAID4会遭遇写损失

		* 对于每一次写操作，阵列管理软件不仅要修改用户数据，而且要修改相应的校验位。
			$$
			P'(B) = P(B) \oplus B_0 \oplus B_0'
			$$

	* 当涉及所有磁盘的数据条带的较大I/O写操作时，只要用新的数据位来进行简单的计算即可得到奇偶校验位

	* 每一次写操作必须涉及到唯一的校验盘，校验盘会成为瓶颈。



## RAID5

* 与RAID4组织方式相似

* 在所有磁盘上都分布了奇偶校验条带

	* 避免潜在的I/O瓶颈问题

* 访问时的“两读两写”
	$$
	P'(B) = P(B) \oplus B_0 \oplus B_0'
	$$



## RAID6

* 采用两种不同的校验码，并将校验码以分开的块存于不同的磁盘中
* 优点
	* 提升数据可用性：只有在平均修复时间间隔内3个磁盘都出了故障，才会造成数据丢失
* 缺点
	* 写损失：每次写都要影响两个校验块