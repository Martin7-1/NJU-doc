# RAII

## What is RAII

Resource Acquisition Is Initialization（资源获取既是初始化），是一种 C++ 编程技术，它绑定了在使用前必须获取的资源的生命周期（分配的堆内存、执行线程、打开的套接字、打开的文件、锁定的互斥体、磁盘空间、数据库连接——任何东西）供应有限）到对象的生命周期。

RAII 保证资源可用于任何可能访问对象的函数（资源可用性是类不变的，消除了多余的运行时测试）。它还保证所有资源在其控制对象的生命周期结束时以获取相反的顺序释放。同样，如果资源获取失败（构造函数异常退出），则每个完全构造的成员和基础子对象获取的所有资源都以初始化的相反顺序释放。这利用了核心语言特性（对象生存期、范围退出、初始化顺序和堆栈展开）来消除资源泄漏并保证异常安全。该技术的另一个名称是范围绑定资源管理 (SBRM)，在基本用例之后，RAII 对象的生命周期由于范围退出而结束。

RAII 可以总结如下：

* 将资源封装到类中，且
  * 构造函数获取资源并建立所有类不变量，如果无法完成则抛出异常
  * 析构函数释放资源，且永远不会抛出异常
* 永远通过 RAII-class 来使用资源
  * 本身具有自动呢存储期限或者临时生命周期。或者，
  * 具有受自动或临时对象的生命周期限制的生命周期


## 总结

在Cpp的标准库中，提供了一些RAII的Wrapper（包括 `std::unique_ptr<>`, `std::shared_prt<>` 动态管理内存，`std::lock_guard`, `std::unique_lock`, `std::shared_lock` 来管理锁定互斥体）。